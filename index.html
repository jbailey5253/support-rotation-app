<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Support Rotation</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    .list { margin: 20px 0; }
    .list ul { list-style-type: none; padding: 0; }
    .list li { padding: 5px; cursor: pointer; }
    .top-name { font-weight: bold; color: green; }
    .unavailable { color: red; text-decoration: line-through; }
    button { margin-top: 10px; }
  </style>

  <!-- Firebase via CDN -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js"></script>

  <script>
    // ✅ Your Firebase Config (tailored)
    const firebaseConfig = {
      apiKey: "AIzaSyBI1IvsSOGRXss0dTceJQDnkoXfFdhkinc",
      authDomain: "support-rotation-app.firebaseapp.com",
      projectId: "support-rotation-app",
      storageBucket: "support-rotation-app.firebasestorage.app",
      messagingSenderId: "559311225453",
      appId: "1:559311225453:web:15e121172a5a042ea8b564",
      measurementId: "G-DR1V84QY22"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    firebase.analytics();
  </script>
</head>
<body>
  <h2>Support Rotation</h2>

  <div class="list">
    <h3>Team DEMS</h3>
    <ul id="teamA"></ul>
    <button onclick="assignNext('A')">Assign Next Ticket (DEMS)</button>
  </div>

  <div class="list">
    <h3>Team Aware</h3>
    <ul id="teamB"></ul>
    <button onclick="assignNext('B')">Assign Next Ticket (Aware)</button>
  </div>

  <div id="assignment-msg" style="margin-top: 20px; font-weight: bold;"></div>

  <script>
    let teams = { A: [], B: [] };

    // 🔁 Load initial or live team data
    db.ref('teams').on('value', (snapshot) => {
      if (snapshot.exists()) {
        teams = snapshot.val();
        render('A');
        render('B');
      } else {
        // First-time default initialization
        teams = {
          A: [
            { name: 'Lynnette', available: true },
            { name: 'Dack', available: true },
            { name: 'Shay', available: true },
            { name: 'Dami', available: true },
            { name: 'Anna', available: true }
          ],
          B: [
            { name: 'Jake', available: true },
            { name: 'Tyler', available: true },
            { name: 'David', available: true },
            { name: 'Zachary', available: true },
            { name: 'Paul', available: true }
          ]
        };
        db.ref('teams').set(teams);
      }
    });

    function render(teamKey) {
      const list = document.getElementById(`team${teamKey}`);
      list.innerHTML = '';
      teams[teamKey].forEach((person, index) => {
        const li = document.createElement('li');
        li.className = index === 0 ? 'top-name' : '';
        if (!person.available) li.classList.add('unavailable');
        li.textContent = person.name + (index === 0 ? ' (Next)' : '');
        li.onclick = () => toggleAvailability(teamKey, index);
        list.appendChild(li);
      });
    }

    function toggleAvailability(teamKey, index) {
      teams[teamKey][index].available = !teams[teamKey][index].available;
      db.ref('teams').set(teams);
    }

    function assignNext(teamKey) {
      let team = teams[teamKey];

      if (team[0].available) {
        const person = team.shift();
        team.push(person);
        showAssignment(`${person.name} is assigned the ticket.`);
      } else {
        let assignedIndex = -1;
        for (let i = 1; i < team.length; i++) {
          if (team[i].available) {
            assignedIndex = i;
            break;
          }
        }

        if (assignedIndex !== -1) {
          const assignedPerson = team.splice(assignedIndex, 1)[0];
          team.push(assignedPerson);
          showAssignment(`${assignedPerson.name} is assigned the ticket (top person unavailable).`);
        } else {
          showAssignment("No available team members.");
        }
      }

      db.ref('teams').set(teams);
    }

    function showAssignment(message) {
      document.getElementById("assignment-msg").textContent = message;
    }
  </script>
</body>
</html>
