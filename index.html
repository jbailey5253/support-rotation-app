<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Support Rotation App</title>
  <style>
    :root {
      --bg-color: #f3f4f6;
      --text-color: #1f2937;
      --card-bg: #ffffff;
      --hover-bg: #f3f4f6;
      --muted: #9ca3af;
      --heading-color: #111827;
    }

    body.dark {
      --bg-color: #1f2937;
      --text-color: #f3f4f6;
      --card-bg: #374151;
      --hover-bg: #4b5563;
      --muted: #9ca3af;
      --heading-color: #ffffff;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 900px;
      margin: 0 auto;
    }

    h1 {
      color: var(--heading-color);
    }

    .theme-toggle {
      background-color: #6b7280;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .teams {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
      margin-top: 30px;
    }

    .team {
      background-color: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.05);
      width: 280px;
      transition: background-color 0.3s;
    }

    .team h2 {
      text-align: center;
      color: #2563eb;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
      margin-bottom: 20px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0 0 20px 0;
    }

    li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 8px;
      margin-bottom: 8px;
      border-radius: 6px;
      background-color: var(--hover-bg);
      transition: background-color 0.2s ease;
    }

    li.unavailable {
      color: var(--muted);
      text-decoration: line-through;
    }

    button {
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .assign-button {
      background-color: #2563eb;
      color: white;
      margin-top: 10px;
    }

    .assign-button:hover {
      background-color: #1d4ed8;
    }

    .available {
      background-color: #10b981;
      color: white;
    }

    .available:hover {
      background-color: #059669;
    }

    .unavailable-btn {
      background-color: #ef4444;
      color: white;
    }

    .unavailable-btn:hover {
      background-color: #dc2626;
    }

    #assignment {
      text-align: center;
      font-weight: 500;
      margin-top: 30px;
      font-size: 16px;
    }

    @media (max-width: 640px) {
      .teams {
        flex-direction: column;
        align-items: center;
      }

      .team {
        width: 90%;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Support Rotation App</h1>
    <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
  </header>

  <div class="teams">
    <div class="team" id="teamA">
      <h2>DEMS</h2>
      <ul id="listA"></ul>
      <button class="assign-button" onclick="assignNext('A')">Assign Next</button>
    </div>
    <div class="team" id="teamB">
      <h2>Aware</h2>
      <ul id="listB"></ul>
      <button class="assign-button" onclick="assignNext('B')">Assign Next</button>
    </div>
  </div>
  <p id="assignment"></p>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBI1IvsSOGRXss0dTceJQDnkoXfFdhkinc",
      authDomain: "support-rotation-app.firebaseapp.com",
      databaseURL: "https://support-rotation-app-default-rtdb.firebaseio.com/",
      projectId: "support-rotation-app",
      storageBucket: "support-rotation-app.firebasestorage.app",
      messagingSenderId: "559311225453",
      appId: "1:559311225453:web:15e121172a5a042ea8b564",
      measurementId: "G-DR1V84QY22"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let teams = {
      A: [
        { name: "Lynnette", available: true },
        { name: "Dack", available: true },
        { name: "Shay", available: true },
        { name: "Dami", available: true },
        { name: "Anna", available: true },
      ],
      B: [
        { name: "Jake", available: true },
        { name: "Tyler", available: true },
        { name: "David", available: true },
        { name: "Zachary", available: true },
        { name: "Paul", available: true },
      ],
    };

    db.ref('teams').on('value', (snapshot) => {
      if (snapshot.exists()) {
        teams = snapshot.val();
        render('A');
        render('B');
      }
    });

    function render(teamKey) {
      const team = teams[teamKey];
      const list = document.getElementById(teamKey === 'A' ? 'listA' : 'listB');
      list.innerHTML = '';

      team.forEach((person, index) => {
        const li = document.createElement('li');
        li.className = person.available ? '' : 'unavailable';

        const buttonClass = person.available ? 'available' : 'unavailable-btn';

        li.innerHTML = `
          ${person.name}
          <button class="${buttonClass}" onclick="toggleAvailability('${teamKey}', ${index})">
            ${person.available ? 'Available' : 'Unavailable'}
          </button>`;
        list.appendChild(li);
      });
    }

    function toggleAvailability(teamKey, index) {
      teams[teamKey][index].available = !teams[teamKey][index].available;
      db.ref('teams').set(teams);
    }

    function assignNext(teamKey) {
      let team = teams[teamKey];

      if (team[0].available) {
        const person = team.shift();
        team.push(person);
        showAssignment(`${person.name} is assigned the ticket.`);
      } else {
        let assignedIndex = -1;
        for (let i = 1; i < team.length; i++) {
          if (team[i].available) {
            assignedIndex = i;
            break;
          }
        }

        if (assignedIndex !== -1) {
          const assignedPerson = team.splice(assignedIndex, 1)[0];
          team.push(assignedPerson);
          showAssignment(`${assignedPerson.name} is assigned the ticket (top person unavailable).`);
        } else {
          showAssignment("No available team members.");
        }
      }

      db.ref('teams').set(teams);
    }

    function showAssignment(msg) {
      document.getElementById('assignment').innerText = msg;
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    }

    function loadTheme() {
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
        document.body.classList.add('dark');
      }
    }

    // Load saved theme on startup
    loadTheme();
  </script>
</body>
</html>
