<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Support Rotation App</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
      color: #333;
      transition: background-color 0.3s, color 0.3s;
    }

    body.dark {
      background-color: #121212;
      color: #f0f0f0;
    }

    header {
      text-align: center;
      padding: 20px;
      font-size: 24px;
    }

    .theme-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #444;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      border-radius: 5px;
    }

    .teams {
      display: flex;
      justify-content: center;
      gap: 40px;
      flex-wrap: wrap;
      padding: 20px;
    }

    .team {
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 16px;
      width: 300px;
      transition: background-color 0.3s;
    }

    body.dark .team {
      background-color: #1e1e1e;
      border-color: #333;
    }

    h2 {
      text-align: center;
      margin-bottom: 12px;
    }

    ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    li.available {
  background-color: #d4edda;
  color: #155724;
}

li.unavailable {
  background-color: #f8d7da;
  color: #721c24;
  opacity: 0.6;
  text-decoration: line-through;
}

body.dark li.available {
  background-color: #2e4d3d;
  color: #c3f5d2;
}

body.dark li.unavailable {
  background-color: #4f2d31;
  color: #f5c6cb;
}

li.top-person {
  border: 2px solid #007bff;
  font-weight: bold;
  box-shadow: 0 0 10px rgba(0, 123, 255, 0.7);
  background-color: #cce5ff !important;
}

body.dark li.top-person {
  background-color: #203750 !important;
  color: #dceeff;
  border-color: #3399ff;
}
    button {
      padding: 6px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    .available-btn {
      background-color: #dc3545;
      color: white;
    }

    .unavailable-btn {
      background-color: #28a745;
      color: white;
    }

    .assign-button {
      margin-top: 10px;
      width: 100%;
      background-color: #007bff;
      color: white;
    }

    #assignment {
      text-align: center;
      font-size: 18px;
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
  <header>Support Rotation App</header>

  <div class="teams">
    <div class="team" id="teamA">
      <h2>DEMS</h2>
      <ul id="listA"></ul>
      <button class="assign-button" onclick="assignNext('A')">Assign Next</button>
    </div>
    <div class="team" id="teamB">
      <h2>Aware</h2>
      <ul id="listB"></ul>
      <button class="assign-button" onclick="assignNext('B')">Assign Next</button>
    </div>
  </div>

  <div id="assignment"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBI1IvsSOGRXss0dTceJQDnkoXfFdhkinc",
      authDomain: "support-rotation-app.firebaseapp.com",
      databaseURL: "https://support-rotation-app-default-rtdb.firebaseio.com",
      projectId: "support-rotation-app",
      storageBucket: "support-rotation-app.appspot.com",
      messagingSenderId: "559311225453",
      appId: "1:559311225453:web:15e121172a5a042ea8b564",
      measurementId: "G-DR1V84QY22"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let teams = { A: [], B: [] };

    db.ref('teams').on('value', (snapshot) => {
      if (snapshot.exists()) {
        teams = snapshot.val();
        render('A');
        render('B');
        localStorage.setItem('teams', JSON.stringify(teams));
      }
    });

    function render(teamKey) {
      const ul = document.getElementById('list' + teamKey);
      ul.innerHTML = '';
      teams[teamKey].forEach((person, index) => {
        const li = document.createElement('li');
        li.className = person.available ? 'available' : 'unavailable';
        if (index === 0) li.classList.add('top-person');

        const toggleBtn = document.createElement('button');
        toggleBtn.innerText = person.available ? 'Unavailable' : 'Available';
        toggleBtn.className = person.available ? 'available-btn' : 'unavailable-btn';
        toggleBtn.onclick = () => toggleAvailability(teamKey, index);

        li.innerHTML = person.name;
        li.appendChild(toggleBtn);
        ul.appendChild(li);
      });
    }

    function toggleAvailability(teamKey, index) {
      teams[teamKey][index].available = !teams[teamKey][index].available;
      db.ref('teams').set(teams);
    }

    function assignNext(teamKey) {
      const team = teams[teamKey];
      const top = team[0];

      let message = "No one available to assign.";
      if (top.available) {
        team.push(team.shift());
        message = `${team[team.length - 1].name} is assigned the ticket.`;
      } else {
        let nextAvailableIndex = team.findIndex((p, i) => i > 0 && p.available);
        if (nextAvailableIndex !== -1) {
          const person = team.splice(nextAvailableIndex, 1)[0];
          team.push(person);
          message = `${person.name} is assigned the ticket (top person unavailable).`;
        }
      }

      db.ref('teams').set(teams);
      document.getElementById('assignment').innerText = message;
    }

    function toggleTheme() {
      document.body.classList.toggle('dark');
      localStorage.setItem('darkMode', document.body.classList.contains('dark'));
    }

    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark');
    }

    if (!navigator.onLine && localStorage.getItem('teams')) {
      teams = JSON.parse(localStorage.getItem('teams'));
      render('A');
      render('B');
    }
  </script>
</body>
</html>
